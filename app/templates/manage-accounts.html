{% extends "base-template.html" %}

{% block title %}Manage Accounts{% endblock %}

{% block content %}
    <h1>Manage Accounts</h1>
    
    <form method="get" action="{{ url_for('main.manage_accounts') }}" class="d-flex mb-3">
        <input class="form-control me-2" type="search" placeholder="Search by Account Name" aria-label="Search" name="search" value="{{ search_query }}">
        <button class="btn btn-outline-success" type="submit">Search</button>
    </form>
    
    <ul class="list-group">
        {% for account in accounts.items %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ account.account_name }} ({{ account.id }})
            <div>
            <a href="{{ url_for('main.edit_account', account_id=account.id) }}" class="btn btn-secondary btn-sm ml-2">Edit</a> 
            <button type="button" class="btn btn-danger btn-sm ml-2" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal{{ account.id }}">Delete</button>
            </div>
        </li>

        <!-- Confirm Delete Modal -->
        <div class="modal fade" id="confirmDeleteModal{{ account.id }}" tabindex="-1" aria-labelledby="confirmDeleteModalLabel{{ account.id }}" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel{{ account.id }}">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                Are you sure you want to delete this account?
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form method="post" action="{{ url_for('main.delete_account', account_id=account.id) }}">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
                </div>
            </div>
            </div>
        </div>
        {% endfor %}
    </ul>
    
    <nav aria-label="Page navigation" class="mt-3">
  <ul class="pagination justify-content-center flex-wrap">
    <!-- Previous Page Link -->
    <li class="page-item {% if not accounts.has_prev %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('main.manage_accounts', page=accounts.prev_num, search=search_query) }}" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>

    <!-- Page Number Links -->
    {% for page_num in accounts.iter_pages() %}
      {% if page_num %}
        <li class="page-item {% if accounts.page == page_num %}active{% endif %}">
          <a class="page-link" href="{{ url_for('main.manage_accounts', page=page_num, search=search_query) }}">{{ page_num }}</a>
        </li>
      {% else %}
        <!-- Ellipsis for skipped pages -->
        <li class="page-item disabled">
          <a class="page-link">...</a>
        </li>
      {% endif %}
    {% endfor %}

    <!-- Next Page Link -->
    <li class="page-item {% if not accounts.has_next %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('main.manage_accounts', page=accounts.next_num, search=search_query) }}" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>

{% endblock %}
