{% extends "base-template.html" %}

{% block title %}AWS Role Analyzer - Account Details{% endblock %}

{% block content %}
<section class="container mx-auto px-4 jetbrains-mono-custom">
  <h2 class="text-2xl font-bold mb-4 text-white margarine-regular">Account: {{ account.account_name }}</h2>

  <!-- Navigation Tabs -->
  <ul class="flex mb-4 border-b border-gray-200" id="accountDetailsTab" role="tablist">
    <li class="mr-2">
      <a class="inline-block p-2 text-orange-500 hover:text-orange-600 text-white bg-orange-600 rounded-t-lg" id="roles-tab" data-bs-toggle="tab" href="#roles" role="tab" aria-controls="roles" aria-selected="true">Roles</a>
    </li>
    <li class="mr-2">
      <a class="inline-block p-2 text-orange-500 hover:text-orange-600" id="trusted-users-tab" data-bs-toggle="tab" href="#trusted-users" role="tab" aria-controls="trusted-users" aria-selected="false">Trusted Users</a>
    </li>
    <li class="mr-2">
      <a class="inline-block p-2 text-orange-500 hover:text-orange-600" id="iam-users-tab" data-bs-toggle="tab" href="#iam-users" role="tab" aria-controls="iam-users" aria-selected="false">IAM Users</a>
    </li>
  </ul>

  <div class="tab-content" id="accountDetailsTabContent">
    
    <!-- Roles Tab -->
    <div class="tab-pane fade show active" id="roles" role="tabpanel" aria-labelledby="roles-tab">
      <div class="mb-3 p-4 bg-white border border-gray-300 rounded-md shadow-sm">
        <div class="mb-2">
          <h3 class="text-xl font-bold text-orange-600">Roles</h3>
          <input type="text" id="roleSearchInput" class="block w-full bg-white border border-gray-300 text-orange-600 rounded-md py-2 px-3 shadow-sm focus:outline-none focus:border-orange-600 focus:ring-orange-600 focus:ring-1 sm:text-sm mb-3" placeholder="Search Roles" oninput="filterList('roleSearchInput', 'role-item')" />
        </div>
        <div>
          <ul id="roleList" class="list-group space-y-2">
            {% for role in roles %}
            <li class="list-group-item role-item p-2 bg-gray-100 border border-gray-300 rounded-md">
              <div class="flex justify-between items-center">
                <span class="text-orange-600">{{ role.role_name }}</span>
                  <button class="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded-md" onclick="showRoleDetails('{{ role.role_name }}', this)" data-account-id="{{ account.id }}">View Policies</button>
              </div>
              <div id="details-{{ role.role_name }}" class="role-details hidden mt-2"></div>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Trusted Users Tab -->
    <div class="tab-pane fade" id="trusted-users" role="tabpanel" aria-labelledby="trusted-users-tab">
      <div class="mb-3 p-4 bg-white border border-gray-300 rounded-md shadow-sm">
        <div class="mb-2">
          <h3 class="text-xl font-bold text-orange-600">Trusted Users</h3>
          <input type="text" id="trustedUserSearchInput" class="block w-full bg-white border border-gray-300 text-orange-600 rounded-md py-2 px-3 shadow-sm focus:outline-none focus:border-orange-600 focus:ring-orange-600 focus:ring-1 sm:text-sm mb-3" placeholder="Search Trusted Users" oninput="filterTrustedUsers()" />
        </div>
        <div>
          <ul id="trustedUserList" class="list-group space-y-2">
            {% if trusted_users %}
            {% for role, users in trusted_users.items() %}
            <li class="list-group-item trusted-user-role p-2 bg-gray-100 border border-gray-300 rounded-md">
              <strong class="text-orange-600">Role: {{ role }}</strong>
              <ul class="mt-2 list-group space-y-2 trusted-user-list">
                {% for user in users %}
                <li class="list-group-item trusted-user-item p-2 bg-white border border-gray-300 rounded-md">
                  <div class="flex justify-between items-center">
                    <a href="{{ url_for('main.user_details', user_arn=user.user_arn) }}" class="text-orange-600 hover:underline">{{ user.user_arn }}</a>
                    <button class="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded-md" onclick="showUserDetails('{{ user.user_name }}', this)" data-account-id="{{ account.id }}">View Policies</button>
                  </div>
                  <div id="details-{{ user.user_name }}" class="user-details hidden mt-2"></div>
                </li>
                {% endfor %}
              </ul>
            </li>
            {% endfor %}
            {% else %}
            <li class="list-group-item p-2 bg-gray-100 border border-gray-300 rounded-md">No trusted users found for this account.</li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>

    <!-- IAM Users Tab -->
    <div class="tab-pane fade" id="iam-users" role="tabpanel" aria-labelledby="iam-users-tab">
      <div class="mb-3 p-4 bg-white border border-gray-300 rounded-md shadow-sm">
        <div class="mb-2">
          <h3 class="text-xl font-bold text-orange-600">IAM Users</h3>
          <input type="text" id="userSearchInput" class="block w-full bg-white border border-gray-300 text-orange-600 rounded-md py-2 px-3 shadow-sm focus:outline-none focus:border-orange-600 focus:ring-orange-600 focus:ring-1 sm:text-sm mb-3" placeholder="Search IAM Users" oninput="filterList('userSearchInput', 'user-item')" />
        </div>
        <div>
          <ul id="userList" class="list-group space-y-2">
            {% for user in users %}
            <li class="list-group-item user-item p-2 bg-gray-100 border border-gray-300 rounded-md">
              <div class="flex justify-between items-center">
                <span class="text-orange-600">{{ user.user_name }}</span>
                <button class="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded-md" onclick="showUserDetails('{{ user.user_name }}', this)" data-account-id="{{ account.id }}">View Policies</button>
              </div>
              <div id="details-{{ user.user_name }}" class="user-details hidden mt-2"></div>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <a href="{{ url_for('main.index') }}" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-md mt-3">Back to Accounts</a>
</section>

{% block scripts %}
<script src="{{ url_for('static', filename='js/account_details.js') }}"></script>
{% endblock %}
{% endblock %}
